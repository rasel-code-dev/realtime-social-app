var B=Object.defineProperty,U=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var T=(o,a,l)=>a in o?B(o,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[a]=l,M=(o,a)=>{for(var l in a||(a={}))G.call(a,l)&&T(o,l,a[l]);if(z)for(var l of z(a))J.call(a,l)&&T(o,l,a[l]);return o},j=(o,a)=>U(o,Y(a));import{R as S,j as e,c as t,r as O,F as Q,b as K,L as X,n as Z}from"./vendor.369462a2.js";import{f as F,a as P}from"./index.e0c26ee0.js";const W=o=>{const{onSubmit:a,cancelBtn:l,onCancel:n,parent_id:f}=o,[d,r]=S.useState({text:"",parent_id:f});function w(v){v.preventDefault(),a&&a(d)}return e("div",{children:t("div",{className:"add-comment-form",children:[e("textarea",{onChange:v=>r(j(M({},d),{text:v.target.value})),className:"input-item",name:"text",placeholder:"Post your comment",id:"text"}),t("div",{className:"flex justify-end",children:[l&&e("button",{onClick:n,className:"btn-sm btn",children:"Cancel"}),e("button",{onClick:w,className:"btn btn-sm ml-2",children:"Post"})]})]})})},ee=o=>{const{comment:a,onDeleteComment:l,onFetchNestedComment:n,onHideReply:f,onSetShowReplyCommentForm:d,showReplyCommentForm:r,onSubmitAddComment:w}=o,[v,N]=S.useState("");function L(p){N(p===v?"":p)}const c=O.exports.useMemo(()=>b(a),[a,a.reply,v,r]);function b({_id:p,text:R,post_id:A,user_id:H,created_at:x,reply:h=!1,child_comment_count:C,author:{username:D,avatar:k}}){function I(E){let s=new Date,u=1e3,i=u*60,m=i*60,y=m*24,g=s-new Date(E),_="";return Math.floor(g/y)?_=Math.floor(g/y)+" day ago":Math.floor(g/m)?_=Math.floor(g/m)+" hour ago":Math.floor(g/i)?_=Math.floor(g/i)+" min ago":Math.floor(g/u)?_=Math.floor(g/u)+" sec ago":_="a second ago",_}return e("div",{className:"my-4 mt-6",children:t("div",{className:"flex",children:[e("div",{className:"w-5 mr-2",children:e("img",{className:"w-full radius-100",src:F(k)})}),t("div",{className:"comment-body flex-1",children:[t("div",{className:"comment-body-text px-2 py-1 bg-gray-9  text-sm rounded",children:[e("h1",{children:t("a",{className:"text-blue-600 text-sm",href:"",children:[D," ID: ",p]})}),t("h4",{className:"text-xs",children:["render timestamp ",Date.now().toString()]}),e("h1",{className:"text-sm",children:R})]}),t("div",{className:"comment-action flex mt-1 text-xs text-gray-dark-9  items-center",children:[e("li",{className:"",children:e("i",{className:"fa fa-heart hover:text-primary"})}),e("li",{className:"mx-3",children:e("i",{onClick:()=>d(p),className:"fa fa-reply mr-1"})}),t("li",{children:[e("i",{className:"fa fa-clock mr-1"}),I(new Date(x))]}),t("li",{className:"ml-3  relative",children:[e("span",{className:"cursor-pointer hover:text-primary",onClick:()=>L(p),children:"more"}),v===p&&e("div",{className:"bg-white w-40 comment_option absolute shadow_1",children:t("ul",{className:"",children:[e("li",{className:"px-2 py-1 cursor-pointer hover:bg-primary_light  hover:text-primary flex",children:t("span",{className:"pointer-events-none",children:[e("i",{className:"fa fa-pen mr-1 "}),"  Edit comment"]})}),e("li",{onClick:()=>l(p),className:"px-2 py-1 cursor-pointer hover:bg-primary_light hover:text-primary flex",children:t("span",{className:"pointer-events-none",children:[e("i",{className:"fa fa-trash mr-1"})," Delete comment"]})})]})})]})]}),r===p&&e(W,{onSubmit:w,parent_id:p,cancelBtn:!0,onCancel:()=>d("")}),C>0&&t("div",{onClick:()=>h&&h.length>0?f(p):n(p,A),className:"flex mt-3 items-center",children:[e("i",{className:"fa text-xs text-gray-light-7 fa-reply mr-1"}),t("h4",{className:"text-gray-light-7 text-xs hover:text-primary cursor-pointer",children:[" ",h&&h.length>0?"hide reply comments":"show reply"," ",C]})]}),h&&h.map(E=>b(E))]})]})})}return c};const te=()=>t("div",{className:"lds-ripple",children:[e("div",{}),e("div",{})]});let V=[{type:"LIKE",icon:"static/icon/facebook-reaction-like.svg"},{type:"LOVE",icon:"static/icon/facebook-reaction-love.svg"},{type:"HAHA",icon:"static/icon/facebook-reaction-haha.svg"},{type:"WOW",icon:"static/icon/facebook-reaction-wow.svg"},{type:"SAD",icon:"static/icon/facebook-reaction-sad.svg"},{type:"ANGRY",icon:"static/icon/facebook-angry.svg"}],q;function ae(o){const{post:a,authId:l,toggleLikeHandler:n}=o,[f,d]=S.useState(!1);function r(){return e("div",{children:e("ul",{className:"flex bg-gray-9  px-2 py-2 rounded",children:V.map((c,b)=>e("li",{className:"mr-1 cursor-pointer",children:e("img",{className:"w-6 flex px-1",onClick:p=>n(a._id,c.type),src:F(c.icon),alt:"reaction-logo"})},b))})})}function w(c){q=setInterval(()=>{d(!0)},500)}function v(c){clearInterval(q),d(!1)}let N=[];a.likes.forEach(c=>{N.findIndex(b=>b.reaction===c.reaction)===-1&&N.push(c)});function L(){return e("div",{className:"flex",children:t("ul",{className:"flex relative reaction_emoji",children:[N.map((c,b)=>e("li",{className:"w-5",children:e("img",{className:"w-full",src:F(V.find(p=>p.type===c.reaction).icon),alt:""})},b)),t("li",{className:"number_count",children:["+",a.likes.length]})]})})}return e("div",{className:"mt-4",children:t("ul",{className:"text-sm justify-between items-start",children:[t("div",{className:"mx-1 flex items-center justify-between",children:[e("li",{className:"flex py-1",children:N.length>0?t("div",{className:"flex",children:[L(),t("div",{className:"flex",children:[e("span",{className:"text-sm font-medium",children:N.find(c=>c.user&&c.user[0]._id===l)?"You ":" "}),N.slice(N.length-3).map(c=>t("span",{className:"text-sm font-medium",children:["  ",c.user&&c.user[0]._id!==l&&` And ${c.user[0].username} `,"  "]}))]})]}):t(Q,{children:[e("img",{className:"w-5 cursor-pointer hover:text-pink-700",onClick:c=>n(a._id,"LIKE"),src:F("static/icon/facebook-reaction-like.svg"),alt:""}),e("span",{className:"font-normal ml-1",children:a.likes.length>0?a.likes.length:"0"})]})}),t("li",{className:"ml-5 flex items-center",children:[e("i",{className:"far fa-comment-alt-dots"}),e("span",{className:"font-normal ml-2",children:a.total_comments>0?a.total_comments:""})]})]}),t("div",{className:"flex items-center justify-around border-b border-t border-gray-9 border-opacity-75 py-1 ",children:[e("li",{onMouseLeave:v,onMouseEnter:w,children:f?r():t("span",{children:[e("i",{className:"fa fa-thumbs-up mr-1"}),e("span",{children:"Like"})]})}),t("li",{children:[e("i",{className:"far fa-comment-alt-dots mr-1"}),e("span",{children:"Comment"})]})]})]})})}function ne(o){let a="";const l=K();let{post:n,authId:f,renderComments:d}=o,[r,w]=S.useState({});const[v,N]=S.useState(!1);function L(x){let h=x.text.trim();P.post("api/add-comment",{parent_id:null,text:h,post_id:n._id,user_id:f}).then(C=>{})}function c(x,h){f&&P.post("/api/toggle-like",{post_id:x,reaction:h,user_id:f}).then(C=>{if(C.status===201){let{like:D,updateLike:k,removeLike:I}=C.data;D?(a=h,l({type:"ADD_LIKE",payload:{user_id:f,post_id:x,reaction:h}})):I?l({type:"REMOVE_LIKE",payload:{user_id:f,post_id:x}}):k&&(a=k.reaction,l({type:"UPDATE_LIKE",payload:{user_id:f,post_id:x,reaction:k.reaction}}))}})}function b(x){r&&r._id?w({}):P.get(`/api/posts/${x}`).then(h=>{h.status===200&&p(h.data.post._id,h.data.post)})}function p(x,h){let{pageSize:C,currentPage:D}={pageSize:10,currentPage:1};P.get(`api/comments?post_id=${x}&page_size=${C}&current_page=${D+1}`).then(k=>{if(k.status===200){let I=M({},h);I.comments=k.data.comments,w(I)}})}function R(x,h){let C=x.findIndex(D=>D.reaction===h);return console.log(C),C!==-1}const A=S.useMemo(()=>H(),[n._id,n.likes.length,n.likes,R(n.likes,a)]);function H(){return t("div",{className:"",children:[e("div",{className:"post_meta flex",children:t("div",{className:"flex flex-1",children:[e("div",{className:"mr-1 w-10",children:e("img",{style:{width:"100%"},className:"rounded-full",src:F(n.author.avatar),alt:""})}),t("div",{className:"w-full",children:[t("div",{className:"flex flex-1 w-full justify-between items-center",children:[t("div",{className:"flex flex-1",children:[e("h4",{className:"text-primary font-400 mr-1",children:e(X,{to:`/profile/${n.author.username}`,children:n.author.username})}),e("h4",{className:"mr-4 font-400",children:"Timeline"})," ",Date.now().toString()]}),e("i",{className:"far fa-ellipsis-h cursor-pointer"})]}),t("div",{className:"flex items-center text-gray-light-6",children:[e("i",{className:"text-xs fa fa-globe-americas mr-1"}),t("div",{className:"text-xs font-400 ",children:["Published:  Created on ",new Date(n.created_at).toDateString()]})]})]})]})}),n.title&&e("h4",{className:"font-medium mt-1 mb-2",onClick:()=>b(n._id),children:n.title}),e("p",{className:"post-content mb-0 mt-1 text-sm",children:r&&r._id===n._id?r.description:n.description.slice(1,150)}),e("a",{onClick:()=>b(n._id),className:"btn btn-a",children:r&&r._id?"Less":"Read more"}),e(ae,{post:n,authId:f,toggleLikeHandler:c}),e("h3",{onClick:()=>N(!v),className:"text-sm mt-4 mb-1 font-medium cursor-pointer",children:"Write a Comment..."}),v&&e(W,{onSubmit:L}),r.comments&&d(n._id,r.comments,n.total_comments)]},n._id)}return A}const se=o=>async(a,l)=>{try{let n=l(),f=n.postState.postPagination.pageSize,d=1;if(o&&(d=o.pageNumber),!o&&n.postState.postPagination.pageNumber===0){let r=await P.get(`/api/posts?pageSize=${f}&pageNumber=${d}`);r.status===200&&a({type:"FETCH_POSTS",payload:{posts:r.data.posts,postPagination:{pageNumber:d}}})}}catch{}},ie=o=>{const{postState:a,authState:l}=o,[n,f]=S.useState(!1),[d,r]=S.useState({}),[w,v]=S.useState({pageSize:1,currentPage:1}),[N,L]=S.useState(""),[c,b]=S.useState("");S.useState(!1);const p=K();O.exports.useEffect(()=>{f(!0),p(se(null)),a.postPagination.pageNumber&&f(!1)},[a.postPagination.pageNumber]);function R(){let{pageSize:s,currentPage:u}=w;P.get(`api/comments?${d.id}&page_size=${s}&current_page=${u+1}`).then(i=>{if(i.status===200){let m=M({},d);m.comments.push(...i.data.comments),r(m),v(j(M({},w),{currentPage:w.currentPage+1}))}})}function A(s,u){P.get(`/api/comments?post_id=${u}&parent_id=${s}`).then(i=>{if(i.status===200){let m=d.comments.findIndex(y=>y.id===s);if(m!==-1){let y=M({},d);y.comments[m].reply=i.data.comments,r(y)}}})}function H(s){let u=d.comments.findIndex(i=>i.id===s);if(u!==-1){let i=M({},d);i.comments[u].reply=[],r(i)}}function x(s){b(c===s?"":s)}function h(s){function u(i,m,y=null){Array.isArray(i)&&i.map(g=>{if(g.reply&&g.reply.length>0&&u(g.reply,m,g),g.id===m)if(y&&y.reply){let _=y.reply.findIndex($=>$.id===g.id);y.reply.splice(_,1)}else{let _=i.findIndex($=>$.id===g.id);i.splice(_,1)}})}P.delete(`/api/comments/${s}`).then(i=>{if(i.status===201){let m=M({},d);u(m.comments,s,null),r(m)}})}function C(s,u){let i=M({},s),m=s.text.trim();P.post("api/add-comment",{parent_id:i.parent_id,text:m,post_id:u,user_id:l._id}).then(y=>{})}function D(s){if(N===s){L("");return}L(s)}function k(s,u,i){return e("div",{children:t("div",{className:"comment_list mt-5",children:[u&&u.map((m,y)=>e(ee,{onSubmitAddComment:C,onHideReply:H,onDeleteComment:h,showMoreCommentOptionId:N,handleToggleMoreOption:D,onFetchNestedComment:A,showReplyCommentForm:c,onSetShowReplyCommentForm:x,comment:m},y)),i&&e("h5",{onClick:R,className:"text-sm font-medium text-center text-gray-light-7 hover:text-primary cursor-pointer",children:"+More comment"})]})})}function I(){return a.posts.map((s,u)=>e("div",{className:"post p-4 bg-white mb-4 rounded",children:e(ne,{post:s,authId:l._id,renderComments:k},s._id)},u))}function E(){let[s,u]=S.useState("");function i(){P.post("/api/post",{description:s}).then(m=>{console.log(m)})}return t("div",{className:"mt-2 px-4 mb-5 bg-white rounded py-3 ",children:[e("h4",{className:"text-md font-medium mb-1",children:"What is in your mind"}),t("div",{className:"add-comment-form",children:[e("textarea",{onChange:m=>u(m.target.value),className:"input-item",name:"text",rows:4,placeholder:"Share some what you are thinking?",id:"text",defaultValue:s}),t("div",{className:"flex mb-1",children:[e("li",{className:"list-none text-gray-700  px-1 pl-0",children:e("i",{className:"fa fa-image"})}),e("li",{className:"list-none text-gray-700 px-1",children:e("i",{className:"fa fa-smile"})})]}),e("div",{className:"flex",children:e("button",{onClick:i,className:"btn btn-sm w-full",children:"Post"})})]})]})}return e("div",{children:t("div",{className:"max-w-full mx-auto",children:[E(),n?e("div",{className:"w-10 mx-auto",children:e(te,{})}):I()]})})};function oe(o){return{postState:o.postState,authState:o.authState}}var me=Z(oe,{})(ie);export{me as default};

import{R as l,j as e,c as o,l as S,e as _,m as b,b as w}from"./vendor.369462a2.js";import{f as N,a as g}from"./index.1d0085a1.js";const E=h=>{let{_id:t,appState:c,primateMessage:s,onDeleteMessage:p,room:r,textMsg:x}=h,n=l.useMemo(()=>u(),[t,c,r]);function u(){return e("div",{children:e("div",{className:"recent-chat-message px-5 mt-2 overflow-y-auto",children:s&&s[r]&&s[r].map((i,f)=>o("div",{className:["msg flex items-start mt-1.5",i.from._id===t?"own-msg":""].join(" "),children:[e("img",{className:"w-5 md:w-8 radius-100% mr-2",src:N(i.from.avatar),alt:""}),o("div",{className:"msg-text",children:[e("div",{className:"rounded min-w-100px px-2 py-1 bg-primary bg-opacity-10",children:e("p",{children:i.text})}),e("span",{className:"text-xs",children:i.from._id===t&&e("div",{children:e("i",{onClick:()=>p(i._id),className:"cursor-pointer far fa-trash"})})})]})]},f))})})}return n};let d=S("ws://localhost:1001");const C=h=>{const{appState:t,authState:c}=_(a=>({appState:a.appState,authState:a.authState})),[s,p]=l.useState(null);l.useState([]);const[r,x]=l.useState("");let n=b(),u=w();l.useEffect(async()=>{let{friend_username:a,room:m}=n;t.friends.length===0&&g.get(`/api/user/friend?friend_username=${a}`).then(y=>{y.status===200&&p(y.data.friend)});let v=await g.get(`/api/messages?room=${m}`);return v.status===200&&u({type:"FETCH_PRIVATE_MSG",payload:{room:m,messages:v.data.messages}}),()=>{}},[]);function i(){}l.useEffect(()=>{d.on("connect",()=>{d.send("Hello!"),d.on("message",a=>{console.log(a)}),d.on("all-message",a=>{console.log(a)})})},[]);function f(){d.emit("message",{text:r,to:s._id,from:c._id,room:n.room})}function M(a){g.delete(`/api/message/${a}`).then(m=>{m.status===201&&u({type:"DELETE_MESSAGE",payload:{room:n.room,_id:m.data._id}})})}return o("div",{className:"container px-0-f",children:[e("button",{className:"btn",onClick:i,children:"Leave"}),s&&o("div",{className:"chat-friend-header bg-warmGray-500 bg-opacity-5 px-4 py-2 flex justify-between items-center",children:[o("div",{className:"flex items-center",children:[e("img",{className:"w-10 radius-100%",src:N(s.avatar),alt:""}),e("h4",{className:"ml-2",children:s.username}),e("span",{className:["ml-2 w-2 h-2 radius-100% ",s.isOnline?"bg-primary":"bg-gray-300"].join(" ")}),e("span",{children:s.isOnline?"Online":"Offline"})]}),e("div",{children:e("i",{className:"fa fa-ellipsis-h text-gray-500"})})]}),e(E,{onDeleteMessage:M,appState:t,_id:c._id,primateMessage:t.primateMessage,room:n.room,textMsg:r}),o("div",{className:"relative chat-message-form w-full box-border px-5",children:[e("textarea",{className:"text-gray-400 text-sm font-medium input-item w-full",placeholder:"Write your message",defaultValue:r,onChange:a=>x(a.target.value)}),e("button",{className:"btn mt-2",onClick:f,children:"Send Message"})]})]})};export{C as default};
